#!/bin/sh

#fuzz_targets.test

# I know that I'm in the scripts directory, thus "home" is one directory up
home=$(cd "$(dirname "$0")" && cd .. && echo "/.${PWD%/}/")
home=${home#/.}
home=${home%/}

for target in "${home%/}"/fuzz/*/target
do
    [ -f "$target" ] || continue

    target_dir=${target%/target}
    find "$target_dir" -mindepth 2 -type f -not -path '*/.*' -print0 \
        | xargs -0 "$target"
    target_ret=$?

    [ "$target_ret" -ne 0 ] && exit 1
done

exit 0
